{% extends 'marketing/base.html' %}
{% load static %}

{% block title %}Export Reports - Marketing Hub{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Export Reports</h1>
            <p class="text-gray-600">Generate and export comprehensive reports in various formats</p>
        </div>
        <div class="flex items-center gap-3">
            <a href="{% url 'marketing:daily_reports' %}" class="inline-flex items-center gap-2 rounded-lg bg-white border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                <i data-lucide="activity" class="w-4 h-4"></i>
                Daily Reports
            </a>
            <a href="{% url 'marketing:performance_analytics' %}" class="inline-flex items-center gap-2 rounded-lg bg-white border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                <i data-lucide="bar-chart" class="w-4 h-4"></i>
                Analytics
            </a>
        </div>
    </div>

    <!-- Report Types -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Select Report Type</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for report in report_types %}
            <div class="border border-gray-200 rounded-lg p-6 hover:border-brand-300 hover:shadow-md transition-all cursor-pointer" onclick="selectReport('{{ report.id }}')">
                <div class="flex items-start justify-between mb-4">
                    <div class="h-12 w-12 bg-brand-100 rounded-lg flex items-center justify-center">
                        {% if report.id == 'daily' %}
                            <i data-lucide="activity" class="w-6 h-6 text-brand-600"></i>
                        {% elif report.id == 'monthly' %}
                            <i data-lucide="calendar" class="w-6 h-6 text-brand-600"></i>
                        {% elif report.id == 'customer' %}
                            <i data-lucide="users" class="w-6 h-6 text-brand-600"></i>
                        {% elif report.id == 'sales' %}
                            <i data-lucide="trending-up" class="w-6 h-6 text-brand-600"></i>
                        {% elif report.id == 'production' %}
                            <i data-lucide="factory" class="w-6 h-6 text-brand-600"></i>
                        {% elif report.id == 'financial' %}
                            <i data-lucide="dollar-sign" class="w-6 h-6 text-brand-600"></i>
                        {% else %}
                            <i data-lucide="file-text" class="w-6 h-6 text-brand-600"></i>
                        {% endif %}
                    </div>
                    <input type="radio" name="report_type" value="{{ report.id }}" class="text-brand-600 focus:ring-brand-500" id="report_{{ report.id }}">
                </div>
                <div>
                    <h4 class="text-lg font-medium text-gray-900 mb-2">{{ report.name }}</h4>
                    <p class="text-sm text-gray-600">{{ report.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Export Format -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Select Export Format</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for format in export_formats %}
            <div class="border border-gray-200 rounded-lg p-6 hover:border-brand-300 hover:shadow-md transition-all cursor-pointer" onclick="selectFormat('{{ format.id }}')">
                <div class="flex items-start justify-between mb-4">
                    <div class="h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="{{ format.icon }}" class="w-6 h-6 text-gray-600"></i>
                    </div>
                    <input type="radio" name="export_format" value="{{ format.id }}" class="text-brand-600 focus:ring-brand-500" id="format_{{ format.id }}">
                </div>
                <div>
                    <h4 class="text-lg font-medium text-gray-900 mb-2">{{ format.name }}</h4>
                    <p class="text-sm text-gray-600">
                        {% if format.id == 'pdf' %}
                            Professional PDF format with charts and tables
                        {% elif format.id == 'excel' %}
                            Excel spreadsheet with data and formulas
                        {% elif format.id == 'csv' %}
                            Simple CSV format for data analysis
                        {% endif %}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Date Range Selection -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Select Date Range</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="start_date" class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                <input type="date" id="start_date" name="start_date" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
            </div>
            <div>
                <label for="end_date" class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                <input type="date" id="end_date" name="end_date" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-brand-500">
            </div>
        </div>
        
        <!-- Quick Date Range Buttons -->
        <div class="mt-4 flex flex-wrap gap-2">
            <button type="button" onclick="setDateRange('today')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                Today
            </button>
            <button type="button" onclick="setDateRange('yesterday')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                Yesterday
            </button>
            <button type="button" onclick="setDateRange('week')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                This Week
            </button>
            <button type="button" onclick="setDateRange('month')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                This Month
            </button>
            <button type="button" onclick="setDateRange('quarter')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                This Quarter
            </button>
            <button type="button" onclick="setDateRange('year')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors">
                This Year
            </button>
        </div>
    </div>

    <!-- Report Options -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Report Options</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="flex items-center">
                    <input type="checkbox" id="include_charts" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500">
                    <span class="ml-2 text-sm text-gray-700">Include Charts and Graphs</span>
                </label>
            </div>
            <div>
                <label class="flex items-center">
                    <input type="checkbox" id="include_summary" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500" checked>
                    <span class="ml-2 text-sm text-gray-700">Include Executive Summary</span>
                </label>
            </div>
            <div>
                <label class="flex items-center">
                    <input type="checkbox" id="include_details" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500" checked>
                    <span class="ml-2 text-sm text-gray-700">Include Detailed Data</span>
                </label>
            </div>
            <div>
                <label class="flex items-center">
                    <input type="checkbox" id="include_comparison" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500">
                    <span class="ml-2 text-sm text-gray-700">Include Period Comparison</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Export Actions -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-900">Generate Report</h3>
                <p class="text-sm text-gray-600">Click the button below to generate and download your report</p>
            </div>
            <div class="flex items-center gap-3">
                <button type="button" onclick="previewReport()" class="inline-flex items-center gap-2 rounded-lg bg-white border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                    Preview
                </button>
                <button type="button" onclick="generateReport()" class="inline-flex items-center gap-2 rounded-lg bg-brand-600 px-4 py-2 text-sm font-medium text-white hover:bg-brand-700 transition-colors">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    Generate Report
                </button>
            </div>
        </div>
    </div>

    <!-- Recent Exports -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-6">Recent Exports</h3>
        <div class="text-center py-8">
            <i data-lucide="file-text" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No recent exports</h3>
            <p class="text-gray-500">Your exported reports will appear here for easy access.</p>
        </div>
    </div>
</div>

<script>
function selectReport(reportId) {
    // Uncheck all radio buttons
    document.querySelectorAll('input[name="report_type"]').forEach(radio => {
        radio.checked = false;
    });
    // Check the selected one
    document.getElementById('report_' + reportId).checked = true;
    
    // Update visual selection
    document.querySelectorAll('[onclick^="selectReport"]').forEach(div => {
        div.classList.remove('border-brand-300', 'shadow-md');
        div.classList.add('border-gray-200');
    });
    event.currentTarget.classList.remove('border-gray-200');
    event.currentTarget.classList.add('border-brand-300', 'shadow-md');
}

function selectFormat(formatId) {
    // Uncheck all radio buttons
    document.querySelectorAll('input[name="export_format"]').forEach(radio => {
        radio.checked = false;
    });
    // Check the selected one
    document.getElementById('format_' + formatId).checked = true;
    
    // Update visual selection
    document.querySelectorAll('[onclick^="selectFormat"]').forEach(div => {
        div.classList.remove('border-brand-300', 'shadow-md');
        div.classList.add('border-gray-200');
    });
    event.currentTarget.classList.remove('border-gray-200');
    event.currentTarget.classList.add('border-brand-300', 'shadow-md');
}

function setDateRange(range) {
    const today = new Date();
    const startDate = document.getElementById('start_date');
    const endDate = document.getElementById('end_date');
    
    switch(range) {
        case 'today':
            startDate.value = today.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'yesterday':
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            startDate.value = yesterday.toISOString().split('T')[0];
            endDate.value = yesterday.toISOString().split('T')[0];
            break;
        case 'week':
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            startDate.value = weekStart.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'month':
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            startDate.value = monthStart.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'quarter':
            const quarterStart = new Date(today.getFullYear(), Math.floor(today.getMonth() / 3) * 3, 1);
            startDate.value = quarterStart.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'year':
            const yearStart = new Date(today.getFullYear(), 0, 1);
            startDate.value = yearStart.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
    }
}

function generateReport() {
    const reportType = document.querySelector('input[name="report_type"]:checked');
    const exportFormat = document.querySelector('input[name="export_format"]:checked');
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;
    
    if (!reportType) {
        alert('Please select a report type');
        return;
    }
    
    if (!exportFormat) {
        alert('Please select an export format');
        return;
    }
    
    if (!startDate || !endDate) {
        alert('Please select a date range');
        return;
    }
    
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Generating...';
    button.disabled = true;
    
    // Simulate report generation
    setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
        alert('Report generated successfully! Download will start automatically.');
    }, 2000);
}

function previewReport() {
    const reportType = document.querySelector('input[name="report_type"]:checked');
    
    if (!reportType) {
        alert('Please select a report type to preview');
        return;
    }
    
    alert('Preview feature will be implemented in the next phase. This will show a sample of the selected report.');
}

// Set default date range to current month
document.addEventListener('DOMContentLoaded', function() {
    setDateRange('month');
});
</script>
{% endblock %}
