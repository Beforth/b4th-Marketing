{% extends 'marketing/base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
/* Notification Dropdown Animations */
#notification-dropdown {
    animation: slideDown 0.2s ease-out;
    transform-origin: top right;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Notification Badge Pulse Animation */
#notification-badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.1);
    }
}

/* Smooth scrollbar for notification list */
#notification-list::-webkit-scrollbar {
    width: 4px;
}

#notification-list::-webkit-scrollbar-track {
    background: transparent;
}

#notification-list::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 2px;
}

#notification-list::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
}

/* Line clamp utility */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Bell shake animation on hover */
#notification-bell:hover i {
    animation: bellShake 0.5s ease-in-out;
}

@keyframes bellShake {
    0%, 100% { transform: rotate(0deg); }
    10%, 30%, 50%, 70%, 90% { transform: rotate(-10deg); }
    20%, 40%, 60%, 80% { transform: rotate(10deg); }
}
</style>

<!-- Dashboard Header with Greeting -->
<div class="px-4 py-2 mb-1">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <!-- Left Content - Greeting and Date -->
        <div class="flex flex-col">
            <!-- Greeting Text -->
            <h1 id="greeting-text" class="text-2xl font-bold text-gray-900" 
                data-animate="fade-in-bottom" data-delay="0.2s"
                style="font-family: 'Outfit', sans-serif;">
                Good Evening, {{ user.username|default:"User" }}!
            </h1>
            
            <!-- Date Text -->
            <p id="date-text" class="text-sm text-gray-600" 
               data-animate="fade-in-bottom" data-delay="0.4s"
               style="font-family: 'Outfit', sans-serif;">
                {{ today|date:"l, F j • Y" }}
            </p>
            
            <!-- Motivational Text -->
            <p id="motivational-text" class="text-xs text-blue-600 italic" 
               data-animate="fade-in-bottom" data-delay="0.6s"
               style="font-family: 'Outfit', sans-serif;">
                Stay focused and productive!
            </p>
        </div>
        
        <!-- Right Content - Search, Notification, User Profile -->
        <div class="flex items-center gap-3">
            <!-- Search Bar -->
            <div class="relative" data-animate="fade-in-right" data-delay="0.8s">
                <input type="text" id="search-input" placeholder="Search..." 
                       class="w-64 rounded-lg border border-gray-200 bg-white px-4 py-2 pl-10 text-sm focus:border-blue-500 focus:outline-none"
                       style="font-family: 'Outfit', sans-serif;">
                <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" 
                   style="stroke-width: 2px; stroke-linecap: round; stroke-linejoin: round;"></i>
            </div>
            
            <!-- Notification Icon -->
            <div class="relative" data-animate="fade-in-right" data-delay="1.0s">
                <button id="notification-bell" class="relative rounded-lg p-2 text-gray-600 hover:bg-gray-100 transition-colors">
                    <i data-lucide="bell" class="h-5 w-5"></i>
                    <!-- Notification Badge -->
                    <span id="notification-badge" class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">
                        3
                    </span>
                </button>
                
                <!-- Notification Dropdown -->
                <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-80 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
                    <!-- Header -->
                    <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                        <button id="mark-all-read" class="text-xs text-blue-600 hover:text-blue-700">Mark all as read</button>
                    </div>
                    
                    <!-- Notification List -->
                    <div id="notification-list" class="max-h-96 overflow-y-auto">
                        <!-- Sample notifications - will be populated by JavaScript -->
                    </div>
                    

                </div>
            </div>
            
            <!-- User Profile Component -->
            <button id="user-profile" class="flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 hover:bg-gray-50 transition-colors" 
                    data-animate="fade-in-right" data-delay="1.2s">
                <!-- Avatar -->
                <div class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-100">
                    <span class="text-sm font-semibold text-blue-600">{{ user.username|first|upper|default:"U" }}</span>
                </div>
                
                <!-- Username -->
                <span class="text-sm font-medium text-gray-700">{{ user.username|default:"User" }}</span>
                

            </button>
        </div>
    </div>
</div>

<div class="px-4 space-y-4">

    <!-- Key Metrics Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-3">
        <!-- Total Customers -->
        <div class="bg-white rounded-lg border border-gray-200 p-2 sm:p-3 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-600">Total Customers</p>
                    <p class="text-lg sm:text-xl font-bold text-gray-900">{{ total_customers|default:0 }}</p>
                </div>
                <div class="h-8 w-8 sm:h-10 sm:w-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <i data-lucide="users" class="w-4 h-4 sm:w-5 sm:h-5 text-blue-600"></i>
                </div>
            </div>
        </div>

        <!-- Active Leads -->
        <div class="bg-white rounded-lg border border-gray-200 p-2 sm:p-3 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-600">Active Leads</p>
                    <p class="text-lg sm:text-xl font-bold text-gray-900">{{ active_leads|default:0 }}</p>
                </div>
                <div class="h-8 w-8 sm:h-10 sm:w-10 bg-green-100 rounded-lg flex items-center justify-center">
                    <i data-lucide="target" class="w-4 h-4 sm:w-5 sm:h-5 text-green-600"></i>
                </div>
            </div>
        </div>

        <!-- Pending Quotations -->
        <div class="bg-white rounded-lg border border-gray-200 p-2 sm:p-3 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-600">Pending Quotations</p>
                    <p class="text-lg sm:text-xl font-bold text-gray-900">{{ pending_quotations|default:0 }}</p>
                    {% if pending_quotations > 0 %}
                    <p class="text-xs text-orange-600 flex items-center gap-1 mt-1">
                        <i data-lucide="clock" class="w-3 h-3"></i>
                        Need Follow-up
                    </p>
                    {% endif %}
                </div>
                <div class="h-8 w-8 sm:h-10 sm:w-10 bg-orange-100 rounded-lg flex items-center justify-center">
                    <i data-lucide="file-text" class="w-4 h-4 sm:w-5 sm:h-5 text-orange-600"></i>
                </div>
            </div>
        </div>

        <!-- Production Orders -->
        <div class="bg-white rounded-lg border border-gray-200 p-2 sm:p-3 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-gray-600">In Production</p>
                    <p class="text-lg sm:text-xl font-bold text-gray-900">{{ production_orders|default:0 }}</p>
                    {% if production_orders > 0 %}
                    <p class="text-xs text-blue-600 flex items-center gap-1 mt-1">
                        <i data-lucide="factory" class="w-3 h-3"></i>
                        Active
                    </p>
                    {% endif %}
                </div>
                <div class="h-8 w-8 sm:h-10 sm:w-10 bg-purple-100 rounded-lg flex items-center justify-center">
                    <i data-lucide="settings" class="w-4 h-4 sm:w-5 sm:h-5 text-purple-600"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Process Flow Overview -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- Sales Pipeline -->
        <div class="bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-semibold text-gray-900">Sales Pipeline</h3>
                <a href="{% url 'marketing:sales_pipeline_details' %}" class="text-xs text-blue-600 hover:text-blue-700">View Details</a>
            </div>
            <div class="space-y-3">
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-2">
                        <div class="h-6 w-6 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="users" class="w-3 h-3 text-blue-600"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">New Leads</p>
                            <p class="text-xs text-gray-600">This month</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">{{ new_leads_this_month|default:0 }}</p>
                        {% if leads_growth > 0 %}
                        <p class="text-xs text-green-600">+{{ leads_growth }}%</p>
                        {% elif leads_growth < 0 %}
                        <p class="text-xs text-red-600">{{ leads_growth }}%</p>
                        {% endif %}
                    </div>
                </div>

                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-2">
                        <div class="h-6 w-6 bg-green-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="file-text" class="w-3 h-3 text-green-600"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Quotations Sent</p>
                            <p class="text-xs text-gray-600">This month</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">{{ quotations_sent_this_month|default:0 }}</p>
                        {% if quotations_growth > 0 %}
                        <p class="text-xs text-green-600">+{{ quotations_growth }}%</p>
                        {% elif quotations_growth < 0 %}
                        <p class="text-xs text-red-600">{{ quotations_growth }}%</p>
                        {% endif %}
                    </div>
                </div>

                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-2">
                        <div class="h-6 w-6 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="shopping-cart" class="w-3 h-3 text-purple-600"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Purchase Orders</p>
                            <p class="text-xs text-gray-600">This month</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">{{ pos_this_month|default:0 }}</p>
                        {% if pos_growth > 0 %}
                        <p class="text-xs text-green-600">+{{ pos_growth }}%</p>
                        {% elif pos_growth < 0 %}
                        <p class="text-xs text-red-600">{{ pos_growth }}%</p>
                        {% endif %}
                    </div>
                </div>

                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-2">
                        <div class="h-6 w-6 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="truck" class="w-3 h-3 text-orange-600"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Deliveries</p>
                            <p class="text-xs text-gray-600">This month</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">{{ deliveries_this_month|default:0 }}</p>
                        {% if deliveries_growth > 0 %}
                        <p class="text-xs text-green-600">+{{ deliveries_growth }}%</p>
                        {% elif deliveries_growth < 0 %}
                        <p class="text-xs text-red-600">{{ deliveries_growth }}%</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Regional Performance -->
        <div class="bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-semibold text-gray-900">Regional Performance</h3>
                <a href="{% url 'marketing:regional_performance_details' %}" class="text-xs text-blue-600 hover:text-blue-700">View All</a>
            </div>
            <div class="space-y-3">
                {% for region_data in regional_performance %}
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                    <div class="flex items-center gap-2">
                        {% if forloop.counter0 == 0 %}
                        <div class="h-6 w-6 bg-red-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="map-pin" class="w-3 h-3 text-red-600"></i>
                        </div>
                        {% elif forloop.counter0 == 1 %}
                        <div class="h-6 w-6 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="map-pin" class="w-3 h-3 text-blue-600"></i>
                        </div>
                        {% elif forloop.counter0 == 2 %}
                        <div class="h-6 w-6 bg-green-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="map-pin" class="w-3 h-3 text-green-600"></i>
                        </div>
                        {% else %}
                        <div class="h-6 w-6 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i data-lucide="map-pin" class="w-3 h-3 text-purple-600"></i>
                        </div>
                        {% endif %}
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ region_data.region }} Region</p>
                            {% if region_data.target > 0 %}
                            <p class="text-xs text-gray-600">Target: ₹{{ region_data.target|floatformat:0 }}L</p>
                            {% else %}
                            <p class="text-xs text-gray-600">No target set</p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-900">₹{{ region_data.sales|floatformat:0 }}L</p>
                        {% if region_data.target > 0 %}
                        <p class="text-xs {% if region_data.percentage >= 80 %}text-green-600{% elif region_data.percentage >= 50 %}text-yellow-600{% else %}text-red-600{% endif %}">{{ region_data.percentage }}%</p>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-4 text-sm text-gray-500">
                    No regional data available
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Recent Activities & Quick Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
        <!-- Recent Activities -->
        <div class="lg:col-span-2 bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-semibold text-gray-900">Recent Activities</h3>
                <a href="{% url 'marketing:recent_activities_details' %}" class="text-xs text-blue-600 hover:text-blue-700">View All</a>
            </div>
            <div class="space-y-3">
                {% for activity in recent_activities %}
                <div class="flex items-center justify-between p-3 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="flex items-center gap-2">
                        {% if activity.color == 'green' %}
                        <div class="h-8 w-8 bg-green-100 rounded-full flex items-center justify-center">
                            <i data-lucide="{{ activity.icon }}" class="w-4 h-4 text-green-600"></i>
                        </div>
                        {% elif activity.color == 'blue' %}
                        <div class="h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i data-lucide="{{ activity.icon }}" class="w-4 h-4 text-blue-600"></i>
                        </div>
                        {% elif activity.color == 'orange' %}
                        <div class="h-8 w-8 bg-orange-100 rounded-full flex items-center justify-center">
                            <i data-lucide="{{ activity.icon }}" class="w-4 h-4 text-orange-600"></i>
                        </div>
                        {% elif activity.color == 'purple' %}
                        <div class="h-8 w-8 bg-purple-100 rounded-full flex items-center justify-center">
                            <i data-lucide="{{ activity.icon }}" class="w-4 h-4 text-purple-600"></i>
                        </div>
                        {% else %}
                        <div class="h-8 w-8 bg-gray-100 rounded-full flex items-center justify-center">
                            <i data-lucide="{{ activity.icon }}" class="w-4 h-4 text-gray-600"></i>
                        </div>
                        {% endif %}
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ activity.title }}</p>
                            <p class="text-xs text-gray-600">{{ activity.description }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        {% if activity.color == 'green' %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            {{ activity.status }}
                        </span>
                        {% elif activity.color == 'blue' %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{ activity.status }}
                        </span>
                        {% elif activity.color == 'orange' %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                            {{ activity.status }}
                        </span>
                        {% elif activity.color == 'purple' %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                            {{ activity.status }}
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                            {{ activity.status }}
                        </span>
                        {% endif %}
                        <p class="text-xs text-gray-500 mt-1">{{ activity.time|timesince }} ago</p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-sm text-gray-500">
                    No recent activities
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow">
            <h3 class="text-base font-semibold text-gray-900 mb-4">Quick Actions</h3>
            <div class="space-y-2">
                <a href="{% url 'marketing:customer_create' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="user-plus" class="w-3 h-3 text-blue-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Add Customer</span>
                </a>

                <a href="{% url 'marketing:visit_create' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-green-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="calendar-plus" class="w-3 h-3 text-green-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Schedule Visit</span>
                </a>

                <a href="{% url 'marketing:quotation_create' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="file-text" class="w-3 h-3 text-purple-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Create Quotation</span>
                </a>

                <a href="{% url 'marketing:expense_create' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-orange-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="dollar-sign" class="w-3 h-3 text-orange-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Add Expense</span>
                </a>

                <a href="{% url 'marketing:visit_tracking' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-red-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="navigation" class="w-3 h-3 text-red-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Live Tracking</span>
                </a>

                <a href="{% url 'marketing:daily_reports' %}" class="flex items-center gap-2 p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors">
                    <div class="h-6 w-6 bg-indigo-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="bar-chart-3" class="w-3 h-3 text-indigo-600"></i>
                    </div>
                    <span class="text-sm font-medium text-gray-900">Daily Reports</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Alerts & Notifications -->
    <div class="bg-white rounded-lg border border-gray-200 p-4 shadow-sm hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-base font-semibold text-gray-900">Alerts & Notifications</h3>
            <a href="{% url 'marketing:alerts_notifications_details' %}" class="text-xs text-blue-600 hover:text-blue-700">View All</a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
            {% if expiring_quotations_today > 0 %}
            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <div class="flex items-center gap-2 mb-1">
                    <i data-lucide="alert-triangle" class="w-3 h-3 text-red-600"></i>
                    <span class="text-xs font-medium text-red-800">Urgent</span>
                </div>
                <p class="text-xs text-red-700">{{ expiring_quotations_today }} quotation{{ expiring_quotations_today|pluralize }} expiring today</p>
            </div>
            {% endif %}
            
            {% if follow_ups_due_today > 0 %}
            <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-center gap-2 mb-1">
                    <i data-lucide="clock" class="w-3 h-3 text-yellow-600"></i>
                    <span class="text-xs font-medium text-yellow-800">Pending</span>
                </div>
                <p class="text-xs text-yellow-700">{{ follow_ups_due_today }} follow-up{{ follow_ups_due_today|pluralize }} due today</p>
            </div>
            {% endif %}
            
            {% if qc_pending > 0 %}
            <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center gap-2 mb-1">
                    <i data-lucide="factory" class="w-3 h-3 text-blue-600"></i>
                    <span class="text-xs font-medium text-blue-800">Production</span>
                </div>
                <p class="text-xs text-blue-700">{{ qc_pending }} QC inspection{{ qc_pending|pluralize }} pending</p>
            </div>
            {% endif %}
            
            {% if deliveries_today > 0 %}
            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center gap-2 mb-1">
                    <i data-lucide="truck" class="w-3 h-3 text-green-600"></i>
                    <span class="text-xs font-medium text-green-800">Dispatch</span>
                </div>
                <p class="text-xs text-green-700">{{ deliveries_today }} deliver{{ deliveries_today|pluralize:"y,ies" }} scheduled today</p>
            </div>
            {% endif %}
            
            {% if expiring_quotations_today == 0 and follow_ups_due_today == 0 and qc_pending == 0 and deliveries_today == 0 %}
            <div class="col-span-4 text-center py-4 text-sm text-gray-500">
                No alerts at this time
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- User Dropdown Menu -->
<div id="user-dropdown" class="hidden absolute bg-white border border-gray-200 rounded-lg shadow-lg py-1 z-50" style="min-width: 160px;">
    <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-all duration-200">
        <i data-lucide="user" class="w-4 h-4"></i>
        Profile
    </a>
    <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-all duration-200">
        <i data-lucide="settings" class="w-4 h-4"></i>
        Settings
    </a>
    <div class="border-t border-gray-100 my-1"></div>
    <a href="#" class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-all duration-200">
        <i data-lucide="log-out" class="w-4 h-4"></i>
        Logout
    </a>
</div>

<script>
// Notification System
const notifications = [
    {
        id: 1,
        title: "New Purchase Order Received",
        message: "PO #PO-2024-001 from ABC Corp worth ₹2.5L",
        type: "success",
        time: "2 hours ago",
        read: false,
        icon: "shopping-cart"
    },
    {
        id: 2,
        title: "Quotation Expiring Soon",
        message: "Quotation #QT-2024-045 expires today",
        type: "warning",
        time: "4 hours ago",
        read: false,
        icon: "clock"
    },
    {
        id: 3,
        title: "Visit Completed",
        message: "Technical discussion with XYZ Ltd completed successfully",
        type: "info",
        time: "1 day ago",
        read: true,
        icon: "map-pin"
    }
];

function renderNotifications() {
    const notificationList = document.getElementById('notification-list');
    const notificationBadge = document.getElementById('notification-badge');
    
    if (!notificationList) return;
    
    const unreadCount = notifications.filter(n => !n.read).length;
    
    // Update badge
    if (unreadCount > 0) {
        notificationBadge.textContent = unreadCount;
        notificationBadge.classList.remove('hidden');
    } else {
        notificationBadge.classList.add('hidden');
    }
    
    // Clear existing notifications
    notificationList.innerHTML = '';
    
    if (notifications.length === 0) {
        // No notifications state
        notificationList.innerHTML = `
            <div class="px-4 py-8 text-center">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i data-lucide="bell-off" class="w-8 h-8 text-gray-400"></i>
                </div>
                <p class="text-sm font-medium text-gray-900 mb-1">No notifications</p>
                <p class="text-xs text-gray-500">You're all caught up! Check back later for updates.</p>
            </div>
        `;
    } else {
        // Render notifications
        notifications.forEach(notification => {
            const notificationElement = document.createElement('div');
            notificationElement.className = `px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors ${!notification.read ? 'bg-blue-50' : ''}`;
            
            let iconColor = 'text-gray-400';
            let bgColor = 'bg-gray-100';
            
            switch(notification.type) {
                case 'success':
                    iconColor = 'text-green-600';
                    bgColor = 'bg-green-100';
                    break;
                case 'warning':
                    iconColor = 'text-orange-600';
                    bgColor = 'bg-orange-100';
                    break;
                case 'error':
                    iconColor = 'text-red-600';
                    bgColor = 'bg-red-100';
                    break;
                case 'info':
                    iconColor = 'text-blue-600';
                    bgColor = 'bg-blue-100';
                    break;
            }
            
            notificationElement.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 ${bgColor} rounded-lg flex items-center justify-center flex-shrink-0">
                        <i data-lucide="${notification.icon}" class="w-4 h-4 ${iconColor}"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between">
                            <p class="text-sm font-medium text-gray-900 truncate">${notification.title}</p>
                            ${!notification.read ? '<div class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 ml-2 mt-1"></div>' : ''}
                        </div>
                        <p class="text-xs text-gray-600 mt-1 line-clamp-2">${notification.message}</p>
                        <p class="text-xs text-gray-400 mt-1">${notification.time}</p>
                    </div>
                </div>
            `;
            
            // Add click handler to mark as read
            notificationElement.addEventListener('click', () => {
                markNotificationAsRead(notification.id);
            });
            
            notificationList.appendChild(notificationElement);
        });
    }
    
    // Re-initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
}

function markNotificationAsRead(notificationId) {
    const notification = notifications.find(n => n.id === notificationId);
    if (notification) {
        notification.read = true;
        renderNotifications();
    }
}

function markAllNotificationsAsRead() {
    notifications.forEach(n => n.read = true);
    renderNotifications();
}

// Initialize notification system
document.addEventListener('DOMContentLoaded', function() {
    const notificationBell = document.getElementById('notification-bell');
    const notificationDropdown = document.getElementById('notification-dropdown');
    const markAllReadBtn = document.getElementById('mark-all-read');
    
    if (notificationBell && notificationDropdown) {
        // Toggle dropdown
        notificationBell.addEventListener('click', function(e) {
            e.stopPropagation();
            notificationDropdown.classList.toggle('hidden');
            if (!notificationDropdown.classList.contains('hidden')) {
                renderNotifications();
            }
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!notificationDropdown.contains(e.target) && !notificationBell.contains(e.target)) {
                notificationDropdown.classList.add('hidden');
            }
        });
        
        // Mark all as read
        if (markAllReadBtn) {
            markAllReadBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                markAllNotificationsAsRead();
            });
        }
        
        // Initial render
        renderNotifications();
    }
});

// Test functions for different notification states
function clearAllNotifications() {
    notifications.length = 0;
    renderNotifications();
}

// Removed loadSampleNotifications - notifications should come from backend via context
// If you need sample data for testing, use the browser console to call this function
function loadSampleNotifications() {
    console.warn('loadSampleNotifications is deprecated. Notifications should come from the backend.');
}

function addNewNotification(title, message, type = 'info', icon = 'bell') {
    const newNotification = {
        id: Date.now(),
        title: title,
        message: message,
        type: type,
        time: 'Just now',
        read: false,
        icon: icon
    };
    
    notifications.unshift(newNotification);
    renderNotifications();
    
    // Show toast notification if available
    if (typeof showToast === 'function') {
        showToast(`New notification: ${title}`, 'info');
    }
}

// Console commands for testing:
// clearAllNotifications() - to test empty state
// loadSampleNotifications() - to load sample notifications
// addNewNotification("Test Title", "Test message", "success", "check-circle") - to add a new notification

// Dynamic Motivational Quotes
const motivationalQuotes = [
    "Stay focused and productive!",
    "Success is the sum of small efforts repeated day in and day out!",
    "Every expert was once a beginner. Every pro was once an amateur!",
    "The way to get started is to quit talking and begin doing!",
    "Don't be afraid to give up the good to go for the great!",
    "Innovation distinguishes between a leader and a follower!",
    "The future belongs to those who believe in the beauty of their dreams!",
    "It is during our darkest moments that we must focus to see the light!",
    "The only way to do great work is to love what you do!",
    "Your limitation—it's only your imagination!",
    "Great things never come from comfort zones!",
    "Dream it. Wish it. Do it!",
    "Success doesn't just find you. You have to go out and get it!",
    "The harder you work for something, the greater you'll feel when you achieve it!",
    "Dream bigger. Do bigger!",
    "Don't stop when you're tired. Stop when you're done!",
    "Wake up with determination. Go to bed with satisfaction!",
    "Do something today that your future self will thank you for!",
    "Little things make big days!",
    "It's going to be hard, but hard does not mean impossible!",
    "Don't wait for opportunity. Create it!",
    "Sometimes we're tested not to show our weaknesses, but to discover our strengths!",
    "The key to success is to focus on goals, not obstacles!",
    "Dream it. Believe it. Build it!",
    "What lies behind us and what lies before us are tiny matters compared to what lies within us!",
    "The only impossible journey is the one you never begin!",
    "In the middle of difficulty lies opportunity!",
    "The future depends on what you do today!",
    "Believe you can and you're halfway there!",
    "The way to get started is to quit talking and begin doing!"
];

// Function to get a random quote
function getRandomQuote() {
    const randomIndex = Math.floor(Math.random() * motivationalQuotes.length);
    return motivationalQuotes[randomIndex];
}

// Function to update the motivational text
function updateMotivationalText() {
    const motivationalElement = document.getElementById('motivational-text');
    if (motivationalElement) {
        // Add fade out effect
        motivationalElement.style.opacity = '0';
        motivationalElement.style.transition = 'opacity 0.3s ease-in-out';
        
        setTimeout(() => {
            motivationalElement.textContent = getRandomQuote();
            // Add fade in effect
            motivationalElement.style.opacity = '1';
        }, 300);
    }
}

// Initialize with a random quote when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateMotivationalText();
    
    // Change quote every 30 seconds
    setInterval(updateMotivationalText, 30000);
    
    // Optional: Change quote on click
    const motivationalElement = document.getElementById('motivational-text');
    if (motivationalElement) {
        motivationalElement.style.cursor = 'pointer';
        motivationalElement.title = 'Click to get a new motivational quote!';
        motivationalElement.addEventListener('click', updateMotivationalText);
    }
});
</script>
{% endblock %}





