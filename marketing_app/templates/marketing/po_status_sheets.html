{% extends 'marketing/base.html' %}
{% load static %}

{% block title %}PO Status Sheets - Marketing Hub{% endblock %}

{% block content %}
<div class="mx-auto w-full p-2 md:p-4 xl:p-2">
    <!-- Modern Header -->
    <div class="mb-4 sm:mb-6">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-xl sm:text-2xl font-bold text-gray-900">PO Status Sheets</h1>
                <p class="text-sm sm:text-base text-gray-600">Complete tabbed interface for all PO Status sheets with forms</p>
            </div>
            <a href="{% url 'marketing:po_status_dashboard' %}" class="inline-flex items-center gap-2 px-3 sm:px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-xs sm:text-sm transition">
                <i data-lucide="arrow-left" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                Back to Dashboard
            </a>
        </div>
    </div>

    <!-- Tabbed Navigation -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-4 sm:mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-4 sm:space-x-8 px-3 sm:px-6 overflow-x-auto" aria-label="Tabs">
                <button type="button" onclick="switchTab('po-details')" 
                        id="tab-po-details"
                        class="tab-button active flex items-center gap-1 sm:gap-2 py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap">
                    <i data-lucide="file-text" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                    PO Details
                </button>
                <button type="button" onclick="switchTab('sheet1')" 
                        id="tab-sheet1"
                        class="tab-button flex items-center gap-1 sm:gap-2 py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap">
                    <i data-lucide="copy" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                    Sheet1
                </button>
                <button type="button" onclick="switchTab('legends')" 
                        id="tab-legends"
                        class="tab-button flex items-center gap-1 sm:gap-2 py-3 sm:py-4 px-1 border-b-2 font-medium text-xs sm:text-sm transition-colors whitespace-nowrap">
                    <i data-lucide="book-open" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                    Legends
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-3 sm:p-6">
            <!-- PO Details Tab -->
            <div id="content-po-details" class="tab-content">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-2 mb-4 sm:mb-6">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900">PO Details - Comprehensive Purchase Order tracking and payment management</h3>
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                        <button onclick="addNewForm('po-details')" class="inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xs sm:text-sm transition">
                            <i data-lucide="plus" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                            Add New
                        </button>
                        <a href="{% url 'marketing:po_status_list' %}" class="inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-xs sm:text-sm transition">
                            <i data-lucide="list" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                            View All Entries
                        </a>
                    </div>
                </div>
                <p class="text-sm sm:text-base text-gray-600 mb-3 sm:mb-4">Core Information Fields, Order Generation Details, and Payment Tracking Structure (5 Payment Phases).</p>
                
                <!-- Forms Container -->
                <div id="po-details-forms-container">
                    <!-- Include PO Status Form -->
                    {% include 'marketing/po_status_tab_form.html' %}
                </div>
            </div>

            <!-- Sheet1 Tab -->
            <div id="content-sheet1" class="tab-content hidden">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-2 mb-4 sm:mb-6">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900">Sheet1 - Duplicate/backup of PO Details sheet</h3>
                    <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                        <button onclick="addNewForm('sheet1')" class="inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-xs sm:text-sm transition">
                            <i data-lucide="plus" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                            Add New
                        </button>
                        <a href="{% url 'marketing:po_status_list' %}" class="inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-xs sm:text-sm transition">
                            <i data-lucide="list" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                            View All Entries
                        </a>
                    </div>
                </div>
                <p class="text-sm sm:text-base text-gray-600 mb-3 sm:mb-4">Identical to PO Details sheet with same column structure and data entries. Contains the same comprehensive tracking system with all payment phases and company details.</p>
                
                <!-- Forms Container -->
                <div id="sheet1-forms-container">
                    <!-- Include PO Status Form -->
                    {% include 'marketing/po_status_tab_form.html' %}
                </div>
            </div>

            <!-- Legends Tab -->
            <div id="content-legends" class="tab-content hidden">
                <div class="mb-4 sm:mb-6">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900">Legends - Reference sheet for formulas and validation</h3>
                </div>
                <p class="text-sm sm:text-base text-gray-600 mb-4 sm:mb-6">Contains system formulas and validation rules (empty data template).</p>
                
                <div class="bg-white border border-gray-200 rounded-lg p-4 sm:p-6">
                    <h4 class="text-sm sm:text-base font-semibold text-gray-800 mb-3 sm:mb-4">Formula set (do not enter the values)</h4>
                    <div class="space-y-3 sm:space-y-4">
                        <div class="p-3 sm:p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <h5 class="text-sm sm:text-base font-medium text-blue-900 mb-2">Payment Calculation Formulas</h5>
                            <p class="text-xs sm:text-sm text-blue-800">Total Agreed Amount = PO Value (Without GST)</p>
                            <p class="text-xs sm:text-sm text-blue-800">Total Received Amount = Sum of all PayR received amounts</p>
                        </div>
                        <div class="p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg">
                            <h5 class="text-sm sm:text-base font-medium text-green-900 mb-2">Validation Rules</h5>
                            <p class="text-xs sm:text-sm text-green-800">• All percentage fields must be between 0-100</p>
                            <p class="text-xs sm:text-sm text-green-800">• Amount fields must be positive numbers</p>
                            <p class="text-xs sm:text-sm text-green-800">• Date fields must be valid dates</p>
                        </div>
                        <div class="p-3 sm:p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <h5 class="text-sm sm:text-base font-medium text-yellow-900 mb-2">Order Type Categories</h5>
                            <p class="text-xs sm:text-sm text-yellow-800">• Stability: Stability testing orders</p>
                            <p class="text-xs sm:text-sm text-yellow-800">• TT: Technology transfer orders</p>
                            <p class="text-xs sm:text-sm text-yellow-800">• Validation: Validation orders</p>
                            <p class="text-xs sm:text-sm text-yellow-800">• Other: Other types of orders</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Create Lucide icons
    lucide.createIcons();
    
    // Tab switching functionality
    window.switchTab = function(tabName) {
        // Hide all tab contents
        const allContents = document.querySelectorAll('.tab-content');
        allContents.forEach(content => {
            content.classList.add('hidden');
        });
        
        // Remove active class from all tab buttons
        const allTabs = document.querySelectorAll('.tab-button');
        allTabs.forEach(tab => {
            tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
            tab.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Show selected tab content
        const selectedContent = document.getElementById('content-' + tabName);
        if (selectedContent) {
            selectedContent.classList.remove('hidden');
        }
        
        // Add active class to selected tab button
        const selectedTab = document.getElementById('tab-' + tabName);
        if (selectedTab) {
            selectedTab.classList.add('active', 'border-blue-500', 'text-blue-600');
            selectedTab.classList.remove('border-transparent', 'text-gray-500');
        }
    };
    
    // Add new form functionality
    window.addNewForm = function(tabName) {
        const container = document.getElementById(tabName + '-forms-container');
        if (container) {
            // Find the first form in the container
            const firstForm = container.querySelector('.bg-white.rounded-lg.border');
            if (firstForm) {
                // Clone the first form
                const newForm = firstForm.cloneNode(true);
                
                // Clear all input values in the cloned form
                const inputs = newForm.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
                
                // Add a subtle header to indicate this is an additional entry
                const additionalHeader = document.createElement('div');
                additionalHeader.className = 'mb-3 sm:mb-4 p-2 sm:p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center justify-between';
                additionalHeader.innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                        <span class="text-xs sm:text-sm font-medium text-blue-900">Additional Entry</span>
                    </div>
                    <button onclick="this.closest('.bg-white').remove()" class="text-red-600 hover:text-red-800 text-xs sm:text-sm">
                        <i data-lucide="x" class="w-3 h-3 sm:w-4 sm:h-4"></i>
                        Remove
                    </button>
                `;
                
                // Insert the header before the form
                newForm.insertBefore(additionalHeader, newForm.firstChild);
                
                // Add the new form to the container
                container.appendChild(newForm);
                
                // Re-initialize Lucide icons for the new form
                lucide.createIcons();
            }
        }
    };
});
</script>
{% endblock %}
