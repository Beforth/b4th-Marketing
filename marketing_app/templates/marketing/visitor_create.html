{% extends 'marketing/base.html' %}
{% load static %}

{% block title %}Add Visitor - Marketing Hub{% endblock %}

{% block content %}
<div class="mx-auto w-full p-2 md:p-4 xl:p-2">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Add Visitor</h1>
                <p class="text-sm text-gray-600">Add a new visitor to the database</p>
            </div>
            <a href="{% url 'marketing:visitor_database' %}" class="inline-flex items-center gap-2 rounded-lg bg-white border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                Back to Visitor Database
            </a>
        </div>
    </div>

    <!-- Visitor Form -->
    <div class="rounded-lg border border-gray-200 bg-white shadow-sm">
        <form method="post" enctype="multipart/form-data" class="p-6 space-y-6">
            {% csrf_token %}
            
            <!-- Personal Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        Full Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name" required 
                           class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                           placeholder="Enter visitor's full name">
                </div>
                
                <div>
                    <label for="company" class="block text-sm font-medium text-gray-700 mb-2">
                        Company <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="company" id="company" required 
                           class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                           placeholder="Enter company name">
                </div>
            </div>

            <!-- Contact Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="designation" class="block text-sm font-medium text-gray-700 mb-2">Designation</label>
                    <input type="text" name="designation" id="designation" 
                           class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                           placeholder="e.g., Product Manager, CEO, etc.">
                </div>
                
                <div>
                    <label for="industry" class="block text-sm font-medium text-gray-700 mb-2">Industry</label>
                    <select name="industry" id="industry" 
                            class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500">
                        <option value="">Select Industry</option>
                        <option value="automotive">Automotive</option>
                        <option value="technology">Technology</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="finance">Finance</option>
                        <option value="retail">Retail</option>
                        <option value="education">Education</option>
                        <option value="government">Government</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <!-- Contact Details -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email Address <span class="text-red-500">*</span>
                    </label>
                    <input type="email" name="email" id="email" required 
                           class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                           placeholder="visitor@company.com">
                </div>
                
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" name="phone" id="phone" 
                           class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                           placeholder="+91 98765 43210">
                </div>
            </div>

            <!-- Exhibition Information -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="exhibition" class="block text-sm font-medium text-gray-700 mb-2">Exhibition</label>
                    <select name="exhibition" id="exhibition" 
                            class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500">
                        <option value="">Select Exhibition</option>
                        {% for exhibition in exhibitions %}
                        <option value="{{ exhibition.id }}">{{ exhibition.name }} - {{ exhibition.start_date|date:"M d, Y" }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select name="status" id="status" 
                            class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500">
                        <option value="new" selected>New</option>
                        <option value="qualified">Qualified</option>
                        <option value="contacted">Contacted</option>
                        <option value="converted">Converted</option>
                        <option value="not_interested">Not Interested</option>
                    </select>
                </div>
            </div>

            <!-- Notes -->
            <div>
                <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                <textarea name="notes" id="notes" rows="4" 
                          class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500" 
                          placeholder="Enter any additional notes about the visitor..."></textarea>
            </div>

            <!-- Form Actions -->
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200">
                <a href="{% url 'marketing:visitor_database' %}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-2 bg-brand-600 text-white rounded-lg shadow-sm text-sm font-medium hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2">
                    Add Visitor
                </button>
            </div>
        </form>
    </div>

    <!-- Help Section -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
        <h4 class="font-medium text-blue-900 mb-2">Visitor Information Guidelines</h4>
        <ul class="text-sm text-blue-800 space-y-1">
            <li>• <strong>Full Name:</strong> Enter the visitor's complete name as it appears on their business card</li>
            <li>• <strong>Company:</strong> Use the official company name for better tracking</li>
            <li>• <strong>Designation:</strong> Include their job title or role in the company</li>
            <li>• <strong>Industry:</strong> Select the most relevant industry category</li>
            <li>• <strong>Email:</strong> Use their primary business email address</li>
            <li>• <strong>Phone:</strong> Include country code for international numbers</li>
            <li>• <strong>Exhibition:</strong> Select the exhibition where you met this visitor</li>
            <li>• <strong>Status:</strong> Update status as you progress through the sales cycle</li>
            <li>• <strong>Notes:</strong> Record key conversation points and follow-up actions</li>
        </ul>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-format phone number
    document.getElementById('phone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 0) {
            if (value.length <= 10) {
                value = '+91 ' + value;
            } else if (value.length > 10) {
                value = '+' + value;
            }
        }
        e.target.value = value;
    });
    
    // Auto-capitalize name and company
    document.getElementById('name').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\b\w/g, l => l.toUpperCase());
    });
    
    document.getElementById('company').addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\b\w/g, l => l.toUpperCase());
    });
    
    // Validate email format
    document.getElementById('email').addEventListener('blur', function(e) {
        const email = e.target.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (email && !emailRegex.test(email)) {
            e.target.setCustomValidity('Please enter a valid email address');
        } else {
            e.target.setCustomValidity('');
        }
    });
});
</script>
{% endblock %}
